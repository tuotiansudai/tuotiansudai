<ui:composition template="center.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pm="http://primefaces.org/mobile"
	xmlns:archer="http://java.sun.com/jsf/archer"
	xmlns:sec="http://www.springframework.org/security/facelets/tags"
	xmlns:o="http://omnifaces.org/ui"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

	<ui:param name="activeCenterMenuUrl" value="/user/bankCardList"></ui:param>
	<ui:param name="pnr_enable" value="#{configHome.getConfigValue('pnrpay_enable') eq '1'}"></ui:param>
	<ui:define name="center_right">
<!-- 未实名认证 -->
	<sec:ifNotGranted roles="INVESTOR,LOANER,GUARANTEE">
			<script>
				$.dialog
						.alert(
								'为了您的账户资金安全，请先进行实名认证!',
								function() {
									window.location.href = "#{path}/user/get_investor_permission";
								});
			</script>
	</sec:ifNotGranted>
<!-- 已实名认证 -->
	<sec:ifAnyGranted roles="INVESTOR,LOANER,GUARANTEE">
		<f:event type="preRenderComponent"
			listener="#{userHome.setId(loginUserInfo.loginUserId)}"></f:event>
		<div class="center_right">
			<h:form id="form">
				<div class="zhcz_h3">已添加银行卡</div>
				<ul class="yhkxx">
					<f:event type="preRenderView"
						listener="#{bankCardList.example.user.setId(loginUserInfo.loginUserId)}"></f:event>
					<!-- <f:event type="preRenderView"
						listener="#{bankCardList.example.setStatus(BankCardStatus.BINDING)}"></f:event> -->
					<f:event type="preRenderView"
						listener="#{bankCardList.setPageSize(1000)}"></f:event>
					<h:panelGroup id="bankCards">
					<ui:repeat var="bankcard" value="#{bankCardList.getBankCardListbyLoginUser()}">
						<li>
							<div class="yhk">
								<img src="#{tplVars.themeImagePath}/umpaybanklogo/#{bankcard.bankNo}.png" />
								<br />
								<ui:param name="bcnL" value="#{bankcard.cardNo.length()}"></ui:param>
								<p> #{fn:substring(bankcard.cardNo,0,4)} **** **** #{fn:substring(bankcard.cardNo,bcnL-4,bcnL)}</p>
							</div>
							<!-- 未审核 -->
							<ui:fragment rendered="#{bankcard.status eq 'uncheck'}">
								<p:commandLink value="修改" actionListener="#{bankCardHome.updateBankCard(bankcard)}" process="@this" update="@form" styleClass="yhkxx_l"></p:commandLink>
								<h:commandLink value="去审核" action="#{bankCardHome.bindingCardTrusteeship(bankcard.id)}" target="_blank" styleClass="yhkxx_r"></h:commandLink>
							</ui:fragment>
							<!-- 已经审核 -->
							<ui:fragment rendered="#{bankcard.status eq 'passed'}">
								<a>已绑定</a>
							</ui:fragment>
							<div class="clear"></div>
						</li>
					</ui:repeat>
					<ui:fragment rendered="#{bankCardList.getBankCardListbyLoginUser().size() lt 1}">
						<li>
							<div class="yhk">
								<p:commandLink actionListener="#{bankCardHome.resetBankCard}" onclick="$('form\\:recardNo').val('')" process="@this" update="@form">
									<img class="jia" src="#{tplVars.themeImagePath}/img46.png" />
								</p:commandLink>
							</div>
							<p:commandLink actionListener="#{bankCardHome.resetBankCard}" rendered="#{not pnr_enable}" onclick="$('form\\:recardNo').val('')" process="@this" update="@form" styleClass="yhkxx_c" value="新增银行卡"></p:commandLink>
							<p:commandLink actionListener="#{bankCardHome.save}" rendered="#{pnr_enable}" target="_blank" process="@this" ajax="false" styleClass="yhkxx_c" value="新增银行卡"></p:commandLink>
							<div class="clear"></div>
						</li>
					</ui:fragment>
					<div class="clear"></div>
					</h:panelGroup>
				</ul>

				<ui:fragment rendered="#{bankCardList.getBankCardListbyLoginUser().size() lt 1 or bankCardHome.isUpdateBankCard}">
					<ui:fragment rendered="#{not pnr_enable}">
					<div class="zhcz_h3 zhcz_h302">
						<ui:fragment rendered="#{not empty bankCardHome.instance.id}">
							修改银行卡
						</ui:fragment>
						<ui:fragment rendered="#{empty bankCardHome.instance.id}">
							新增银行卡
						</ui:fragment>
					</div>
					<div class="txczje">
						
						<div class="txczje02">
							<div class="txczje_l">
								<span>*</span>持卡人
							</div>
							<div class="txczje_r">
								#{fn:substring(userHome.instance.realname,0,1)}**
							</div>
							<div class="clear"></div>
						</div>
						<div class="txczje02">
							<div class="txczje_l">
								<span>*</span>选择银行
							</div>
							<div class="txczje_r">
								<h:selectOneMenu value="#{bankCardHome.instance.bankNo}" styleClass="date_select date_select03">
									<f:selectItems value="#{rechargeList.rechargeBankCards}" var="bc" itemLabel="#{bc.bankName}" itemValue="#{bc.no}" />
								</h:selectOneMenu>
							</div>
							<div class="clear"></div>
						</div>
						<div class="txczje02">
							<div class="txczje_l">
								<span>*</span>卡类型
							</div>
							<div class="txczje_r">
								<h:selectOneMenu required="true" value="#{bankCardHome.instance.bankCardType}" label="卡类型" styleClass="txt02 txt03" maxlength="200">
									<f:selectItem itemLabel="借记卡" itemValue="DEBIT" />
								</h:selectOneMenu>
							</div>
							<div class="clear"></div>
						</div>
						<div class="txczje02">
							<div class="txczje_l">
								<span>*</span>银行卡号
							</div>
							<div class="txczje_r">
								<h:inputText value="#{bankCardHome.instance.cardNo}" styleClass="txt02 txt03"></h:inputText>
							</div>
							<div class="clear"></div>
						</div>
						<div class="txczje02">
							<div class="txczje_l"></div>
							<div class="txczje_r">
								<h:commandLink action="#{bankCardHome.save}" value="保存" styleClass="txczje02_btn hqyzm xz"></h:commandLink>
								<p:commandLink actionListener="#{bankCardHome.resetBankCard}" styleClass="txczje02_btn hqyzm qx" onclick="$('form\\:recardNo').val('')" value="取消" update="@form" process="@this"></p:commandLink>
							</div>
							<div class="clear"></div>
						</div>
					</div>
					</ui:fragment>
				</ui:fragment>
			</h:form>
			<p class="zhcz_p02">
				温馨提示<br />
				1、如果您填写的开户行支行不正确，可能将无法成功提现，由此产生的提现费用将不予返还。<br />
				2、如果您不确定开户行支行名称，可打电话到所在地银行的营业网点询问或上网查询。<br />
				3、不支持提现至信用卡账户。
			</p>
		</div>
		<div class="clear"></div>
		</sec:ifAnyGranted>
	</ui:define>

</ui:composition>