apply plugin: 'java'


dependencies {
    compile project(':ttsd-service')
}

startScripts {
    def default_jmx_port = 2911;
    if (project.hasProperty('rop')) {
        if("invest".equals(rop)){
            default_jmx_port = 2912;
        }
        if("jpush".equals(rop)){
            default_jmx_port = 2913;
        }
    }
    classpath = files('conf') + classpath
    defaultJvmOpts = [
            "-Dcom.sun.management.jmxremote=true",
            "-Dcom.sun.management.jmxremote.port=" + default_jmx_port,
            "-Dcom.sun.management.jmxremote.ssl=false",
            "-Dcom.sun.management.jmxremote.authenticate=false",
            "-Dorg.quartz.scheduler.jmx.export=true"
    ];

}

distZip {
    def defaultProperties = 'all'
    if (project.hasProperty('rop')) {
        defaultProperties = rop;
    }

    archiveName baseName + '-' + defaultProperties + '.zip'

    applicationDistribution.from("src/main/resources/") {
        into 'lib/conf'
        exclude 'mybatis-configuration.xml', 'job-worker.properties', 'job-worker.properties.deploy'
    }
    applicationDistribution.from("src/main/resources/job-worker.properties.deploy/job-worker-${defaultProperties}.properties") {
        into 'lib/conf'
        rename "job-worker-${defaultProperties}.properties", 'job-worker.properties'
    }
}


mainClassName = "com.tuotiansudai.scheduler.Main"
