{% extends "console/tpl/_layout.tpl" %}

{% block script_content %}
    <script>
           $('#createdTime').datetimepicker({
                format: 'yyyy-mm-dd',
                showMeridian: 0,
                startView: 2,
                minView:2,
                autoclose: true
            });
    </script>
{% endblock %}

{% block content %}
    <form class="form-inline" action="{% url 'approved_loan_list' %}" method="GET">

        <div class="form-group">
            <label for="volume">资产类型:</label>
            <select name="loan_type" class="form-control">
                <option value="">全部</option>
                {% for key, value in types %}
                    <option value="{{ key }}" {% if key == request.GET.loan_type %}selected{% endif %}>{{ value }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label for="volume">代理人:</label>
            <input type="text" class="form-control" name="agent__login_name" value="{{request.GET.agent__login_name }}">
        </div>

        <div class="form-group">
            <label for="volume">添加日期:</label>
            <input id="createdTime" name="created_time" class="form-control form-control-datetimepicker"
                   data-date-format="yyyy-mm-dd" value="{{ request.GET.created_time }}" style="width: 120px">
        </div>

        <div class="form-group">
            <label for="volume">资产状态:</label>
            <select name="matching_status" class="form-control">
                <option value="">全部</option>
                {% for key, value in matching_status %}
                    <option value="{{ key }}" {% if key == request.GET.matching_status %}selected{% endif %}>{{ value }}</option>
                {% endfor %}
            </select>
        </div>
        <button type="submit" class="btn btn-primary">查询</button>
    </form>

   <div class="col-sm-10">
   <table class="table">
       <thead>
       <tr>
           <th>资产编号</th>
           <th>添加时间</th>
           <th>资产类型</th>
           <th>代理人</th>
           <th>资产价值(万元)</th>
           <th>资产剩余价值(万元)</th>
           <th>计息周期</th>
           <th>借款人</th>
           <th>借款人身份证号</th>
           <th>资产状态</th>
           <th>已匹配额(万元)</th>
           <th>操作</th>
       </tr>
       </thead>
       <tbody>
       {% for list in approved_loan_list.results %}
           <tr>
               <td style="vertical-align: middle">{{ list.serial_number }}</td>
               <td style="vertical-align: middle">{{ list.created_time }}</td>
               <td style="vertical-align: middle">
                    {% for key,value in types %}
                        {% if key == list.loan_type %}{{ value }}
                        {% endif %}
                    {% endfor %}
               </td>
               <td style="vertical-align: middle">{{ list.agent.login_name }}</td>
               <td style="vertical-align: middle">{{ list.amount }}</td>
               <td style="vertical-align: middle">{{ list.balance }}</td>
               <td style="vertical-align: middle">{{ list.effective_date }}-{{ list.expiration_date }}</td>
               <td style="vertical-align: middle">{{ list.debtor }}</td>
               <td style="vertical-align: middle">{{ list.debtor_identity_card }}</td>
               <td style="vertical-align: middle">
                    {% for key,value in matching_status %}
                        {% if key == list.loan_matching_status %}{{ value }}
                        {% endif %}
                    {% endfor %}
               </td>
               <td style="vertical-align: middle">{{ list.loan_matching_amount.amount__sum|default_if_none:'0' }}</td>
               <td style="vertical-align: middle">
                   {% if list.loan_matching_status == 'EXPIRED' %}
                        <form class="form-inline" action="{% url 'loan' %}" method="GET">
                            <input type="hidden" name="loan_id" value="{{ list.id }}">
                            <button type="submit" class="btn btn-default">还款纪录</button>
                        </form>
                   {% else %}
                       <form class="form-inline" action="{% url 'loan' %}" method="GET">
                            <input type="hidden" name="loan_id" value="{{ list.id }}">
                            <button type="submit" class="btn btn-default">还款</button>
                        </form>
                       <form class="form-inline" action="{% url 'loan' %}" method="GET">
                            <input type="hidden" name="loan_id" value="{{ list.id }}">
                            <button type="submit" class="btn btn-default">还款纪录</button>
                        </form>
                   {% endif %}

               </td>
           </tr>
       {% endfor %}
       </tbody>
   </table>
   </div>

{% endblock %}