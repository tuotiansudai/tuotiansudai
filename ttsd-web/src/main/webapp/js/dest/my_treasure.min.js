require(["jquery","coupon-alert","jquery.ajax.extension","assign_coupon"],function(a){a(function(){var b=a("body"),c=a("#ruleList"),d=a(".model-list");b.on("click",".filters-list li",function(b){b.preventDefault();var c=a(this),e=c.index();c.addClass("active").siblings().removeClass("active"),d.find(".coupon-com:eq("+e+")").show().siblings().hide()}).on("click",".close-btn",function(a){a.preventDefault(),c.fadeOut("fast")}).on("click",".rule-show",function(a){a.preventDefault(),c.fadeIn("fast")}),a("#submitCode").on("click",function(){var b=a("#couponByCode").val(),c=a("#errorText");a(this).prop("disabled",!0),14!=a.trim(b).length?(c.addClass("error-color").find("span").text("请输入正确的兑换码"),a("#couponByCode").val(""),a("#submitCode").removeAttr("disabled")):a.ajax({url:"/my-treasure/"+b+"/exchange",type:"POST",dataType:"json",contentType:"application/json; charset=UTF-8"}).done(function(b){a("#submitCode").removeAttr("disabled");var d=b.message;b.status?(c.addClass("success-color").find("span").text(d),setInterval(function(){location.href="/my-treasure"},1e3)):(c.addClass("error-color").find("span").text(d),a("#couponByCode").val(""))}).fail(function(){a("#submitCode").removeAttr("disabled"),c.addClass("error-color").find("span").text("兑换失败，请重试"),a("#couponByCode").val("")})}),a("#couponByCode").on("focusin",function(b){b.preventDefault(),!!a("#errorText").hasClass("error-color")&&a("#errorText").removeClass("error-color")})})});