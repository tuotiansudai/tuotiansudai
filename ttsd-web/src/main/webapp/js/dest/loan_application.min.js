require(["jquery","layerWrapper","jquery.ajax.extension","jquery.validate","logintip"],function(a,b){a(function(){function c(c,d,e){a("#pledgeType").val(e),a("#infoText").attr("placeholder",d),b.open({type:1,btn:0,area:["auto","auto"],title:[c,"padding:0;text-align:center"],content:a("#homeTip"),cancel:function(){a("#loanForm").find("label.error").hide(),a("#placeText").val("北京")}})}var d=a(".loan-tip");d.on("click",function(d){d.preventDefault();var e=a(this).attr("data-title"),f=a(this).attr("data-holder"),g=a(this).attr("data-type");a.ajax({url:"/isLogin",type:"GET",dataType:"json",contentType:"application/json; charset=UTF-8"}).fail(function(d){if(""==d.responseText)""!=a("#userName").val()?c(e,f,g):b.open({type:1,btn:0,area:["auto","auto"],title:"温馨提示",content:a("#isUser")});else{a("meta[name='_csrf']").remove(),a("head").append(a(d.responseText));var h=a("meta[name='_csrf']").attr("content"),i=a("meta[name='_csrf_header']").attr("content");a(document).ajaxSend(function(a,b,c){b.setRequestHeader(i,h)}),b.open({type:1,title:!1,closeBtn:0,area:["auto","auto"],content:a("#loginTip")}),a(".image-captcha img").trigger("click")}})}),a("#loanForm").validate({debug:!0,rules:{moneyText:{required:!0,digits:!0,min:1,max:1e8},monthText:{required:!0,digits:!0,min:1,max:1e3},infoText:{required:!0,maxlength:200}},messages:{moneyText:{required:"请填写借款金额",digits:"请输入不小于1的整数",min:"请输入不小于1的整数",max:"请输入不大于1亿的整数"},monthText:{required:"请填写借款周期",digits:"请输入不小于1的整数",min:"请输入不小于1的整数",max:"请输入不大于1千的整数"},infoText:{required:"请填写信息",maxlength:"字数限制200字以内"}},submitHandler:function(c){var d={loginName:null,region:a("#placeText").attr("data-value"),amount:a("#moneyText").val(),period:a("#monthText").val(),pledgeInfo:a("#infoText").val(),pledgeType:a("#pledgeType").val()};a.ajax({url:"/loan-application/create",type:"POST",dataType:"json",data:JSON.stringify(d),contentType:"application/json; charset=UTF-8"}).done(function(c){c.data.status&&(b.closeAll(),b.open({type:1,btn:0,area:["auto","auto"],title:"温馨提示",content:a("#successTip"),cancel:function(b){a("#loanForm").find(".input-box").val("")}}))}).fail(function(){b.msg("请求失败，请稍后重试！")})}}),a("body").on("click",".area-bg",function(b){b.preventDefault();var c=a(this),d=c.siblings(".area-list-group");d.slideToggle("fast")}).on("click",".area-list-group li",function(b){b.preventDefault();var c=a(this),d=c.text(),e=c.attr("data-value"),f=c.parent();a("#placeText");a("#placeText").val(d).attr("data-value",e),f.slideUp("fast")}).on("click",".close-btn",function(c){c.preventDefault(),b.closeAll(),a("#loanForm").find(".input-box").val("")})})});