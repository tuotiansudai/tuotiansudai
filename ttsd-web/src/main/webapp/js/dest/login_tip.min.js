define(["jquery","layerWrapper","jquery.ajax.extension","jquery.validate","jquery.form"],function(a,b){!function(){var c=a("#loginTip"),d=a(".form-login",c),e=a(".login-submit",c),f=a(".captcha",c),g=(a("i.error",c),a(".image-captcha img",c)),h=function(){f.val(""),g.attr("src","/login/captcha?"+(new Date).getTime().toString())};g.click(function(){h()});var i=function(){return d.ajaxSubmit({beforeSubmit:function(a,b,c){e.addClass("loading")},success:function(a){a.status?window.location.reload():(h(),e.removeClass("loading"),b.msg(a.message))},error:function(){e.removeClass("loading"),h(),b.msg("用户或密码不正确")}}),!1};d.validate({rules:{username:{required:!0},password:{required:!0},captcha:{required:!0,minlength:5}},messages:{username:{required:"用户名不能为空"},password:{required:"密码不能为空"},captcha:{required:"验证码不能为空",minlength:"验证码不正确"}},errorPlacement:function(a,b){a.appendTo(b.parent())},submitHandler:function(a){i()}}),a(".close-btn",c).on("click",function(a){a.preventDefault(),b.closeAll()}),a("body").on("click",".show-login",function(c){c.preventDefault(),h(),a.ajax({url:"/isLogin",type:"GET",dataType:"json",contentType:"application/json; charset=UTF-8"}).fail(function(c){if(""!=c.responseText){a("head");a("head").append(a(c.responseText));var d=a("meta[name='_csrf']").attr("content"),e=a("meta[name='_csrf_header']").attr("content");a(document).ajaxSend(function(a,b,c){b.setRequestHeader(e,d)}),b.open({type:1,title:!1,closeBtn:0,area:["auto","auto"],content:a("#loginTip")})}})})}()});