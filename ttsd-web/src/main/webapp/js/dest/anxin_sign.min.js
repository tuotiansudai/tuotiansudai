require(["jquery","layerWrapper","jquery.ajax.extension","anxin_qian"],function(a,b){function c(c,d,e,f){var g={type:"POST",url:"",data:{}},h=a.extend(g,c);a.ajax({type:h.type,data:h.data,url:h.url,dataType:"json"}).done(function(a){d&&d(a)}).fail(function(){b.msg("请求数据失败，请刷新页面重试！"),h.thisDom.prop("disabled",!1)})}a.fn.initCheckbox=function(b){return a(this).each(function(){a(this).bind("click",function(){var c=a(this),d=c.find("input:checkbox").prop("checked");d?c.addClass("on"):c.removeClass("on"),b&&b(this)})})},function(){function d(){a("#getSkipCode").val(g+"秒后重新获取").prop("disabled",!0),a("#microPhone").css("visibility","hidden"),0==g&&(clearInterval(f),g=60,a("#getSkipCode").val("重新获取验证码").prop("disabled",!1),a("#microPhone").css("visibility","visible")),g--}var e=a("#safetySignedFrame");isAnxinUser=a("input.bind-data",e).data("is-anxin-user"),$closed=a(".safety-status-box.closed",e),$opened=a(".safety-status-box.opened",e),isAnxinUser?$opened.show():$closed.show(),a("#openSafetySigned").on("click",function(){var d=a(this);d.prop("disabled",!0),c({thisDom:d,url:" /anxinSign/createAccount"},function(a){b.msg('<span class="layer-msg-tip"><i></i>开启成功!</span>',{skin:"msg-tip-box",time:1500,area:["290px","90px"]},function(){$closed.hide(),$opened.show()})},function(){d.prop("disabled",!0)},function(){d.prop("disabled",!1)})}),a(".init-checkbox-style",e).initCheckbox(function(b){var c=a(b).parents(".safety-status-box"),d=a(b).hasClass("on"),e=c.find("button.btn-open");d?e.prop("disabled",!1):e.prop("disabled",!0)}),a("#openAuthorization").on("click",function(){b.open({type:1,title:"安心签免短信授权服务",area:["400px","220px"],shadeClose:!1,content:a("#getSkipPhone")})});var f,g=60;a("#getSkipPhone").on("click",function(e){var g,h=e.target.id,i=a(this);h&&("getSkipCode"==h?g=!1:"microPhone"==h&&(g=!0),"getSkipCode"!=h&&"microPhone"!=h||c({thisDom:i,url:"anxinSign/sendCaptcha",data:{isVoice:g}},function(a){a.success?(d(),f=setInterval(d,1e3)):b.msg("请求失败，请重试或联系客服！")}))}),a("#toOpenSMS").on("click",function(){var d=a(this),e=a("#skipPhoneCode"),f=e.val();return e.on("keyup",function(){var b=a(this);b.parents().find(".error").hide()}),f?(d.prop("disabled",!0),void c({thisDom:d,url:"anxinSign/verifyCaptcha",data:{captcha:f,skipAuth:!0}},function(a){a.success?(b.closeAll(),b.msg('<span class="layer-msg-tip"><i></i>授权成功!</span>',{skin:"msg-tip-box",time:1500,area:["290px","90px"]},function(){location.reload()})):(d.parents().find(".error").show().html("验证码错误"),d.prop("disabled",!1))})):void d.parents().find(".error").show().html("验证码不能为空")}),a("body").on("click","a",function(c){var d,f=c.target,g=a(".safety-agreement-frame",e),h=function(a,d){c.preventDefault(),b.open({type:1,title:a,area:["800px","520px"],shadeClose:!1,content:d})};switch(f.className){case"link-agree-service":d=a(".service-box",g),h("安心平台签服务协议",d);break;case"link-agree-privacy":d=a(".privacy-box",g),h("隐私条款",d);break;case"link-agree-number":d=a(".number-box",g),h("CFCA数字证书服务协议",d);break;case"link-agree-number-authorize":d=a(".number-authorize-box",g),h("CFCA数字证书服务协议",d);break;case"link-agree-free-SMS":d=a(".free-SMS-box",g),h("安心签免短信授权服务协议",d)}})}(),function(){var d=a("#safetySignedList"),e=a(".binding-set",d),f=a(".bind-data",d).data("skip-auth");f?d.find(".sms-open").show():d.find(".sms-close").show(),a(".init-checkbox-style",d).initCheckbox(function(b){var c=a(b).hasClass("on"),d=a("#safetyToOpen ").find(".ok");c?d.prop("disabled",!1):d.prop("disabled",!0)}),e.find(".setlink").on("click",function(){var c,d=a(this),e=d.prev("i").hasClass("ok");c=a(e?"#safetyToClose":"#safetyToOpen"),b.open({type:1,title:"安心签免短信授权服务",area:["400px","200px"],shadeClose:!1,content:c})}),a(".open-safety-box",d).on("click",function(d){var e,f,g=(a(d.target),a(this));if(/cancel/.test(d.target.className))return void b.closeAll();if(/ok/.test(d.target.className)){var h=this.id;"safetyToOpen"==h?(e=!0,f="开启成功"):"safetyToClose"==h&&(e=!1,f="关闭成功"),c({thisDom:g,url:"/anxinSign/switchSkipAuth",data:{open:e}},function(a){a.success?(b.closeAll(),b.msg(f,function(){location.reload()})):b.msg("请求失败，请重试或联系客服！")})}})}()});