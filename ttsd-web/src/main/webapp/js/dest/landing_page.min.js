require(["jquery","underscore","layerWrapper","jquery.validate","jquery.validate.extension","jquery.form","jquery.ajax.extension"],function(a,b,c){!function(){function b(){0==k?(window.clearInterval(timer),g.prop("disabled",!1).text("获取验证码"),k=60):(g.prop("disabled",!0).text(k+"秒后重发"),k--)}function d(){0==k?(window.clearInterval(timer),o.prop("disabled",!1).text("获取验证码"),k=60):(o.prop("disabled",!0).text(k+"秒后重发"),k--)}a(window).width()<700?(a("#phoneCaptcha").find(".captcha").attr({id:"captcha",name:"captcha"}),a("#phoneCaptcha").parent().siblings(".captcha-phone-error").attr("id","captchaErr")):(a("#pcCaptcha").find(".captcha").attr({id:"captcha",name:"captcha"}),a("#pcCaptcha").parent().siblings(".captcha-error").attr("id","captchaErr"));var e=a(".register-user-form"),f=a("#mobile"),g=a(".fetch-captcha"),h=a(".img-change"),i=a(".registered"),j=(a("#login-name"),a("#password"),a("#appCaptcha")),k=60;e.validate({focusInvalid:!1,errorPlacement:function(b,c){b.appendTo(a("#"+c.attr("id")+"Err"))},rules:{loginName:{required:!0,regex:/(?!^\d+$)^\w{5,25}$/,isExist:"/register/user/login-name/{0}/is-exist"},mobile:{required:!0,digits:!0,isPhone:!0,minlength:11,maxlength:11,isExist:"/register/user/mobile/{0}/is-exist"},password:{required:!0,regex:/^(?=.*[^\d])(.{6,20})$/},appCaptcha:{required:!0},captcha:{required:!0,digits:!0,maxlength:6,minlength:6,captchaVerify:{param:function(){var b=a("#mobile").val();return"/register/user/mobile/"+b+"/captcha/{0}/verify"}}},agreement:{required:!0}},messages:{loginName:{required:"请输入用户名",regex:"5位至25位数字与字母下划线组合，不能全部数字",isExist:"用户名已存在"},mobile:{required:"请输入手机号",digits:"必须是数字",minlength:"手机格式不正确",isPhone:"请输入正确的手机号码",maxlength:"手机格式不正确",isExist:"手机号已存在"},password:{required:"请输入密码",regex:"6位至20位，不能全是数字"},appCaptcha:{required:"请输入验证码"},captcha:{required:"请输入手机验证码",digits:"验证码格式不正确",maxlength:"验证码格式不正确",minlength:"验证码格式不正确",captchaVerify:"验证码不正确"},agreement:{required:"请同意服务协议"}},submitHandler:function(a){a.submit()}});var l=function(){a(".image-captcha img").each(function(b,c){a(this).attr("src","/register/user/image-captcha?"+(new Date).getTime().toString())})};l(),a("#appCaptcha").on("focusout",function(b){b.preventDefault(),""!=f.val()&&/0?(13|14|15|18)[0-9]{9}/.test(f.val())&&""!=a("#appCaptcha").val()?g.prop("disabled",!1):g.prop("disabled",!0)}),j.on("focus",function(b){a("#appCaptchaErr").html("")}),h.on("click",function(a){a.preventDefault(),l()}),a(".show-agreement").on("click",function(b){b.preventDefault(),c.open({type:1,title:"拓天速贷服务协议",area:["950px","600px"],shadeClose:!0,move:!1,scrollbar:!0,skin:"register-skin",content:a("#agreementBox")})}),g.on("click",function(d){d.preventDefault();var e=a("#appCaptcha").val(),g=f.val();a.ajax({url:"/register/user/send-register-captcha",type:"POST",dataType:"json",data:{imageCaptcha:e,mobile:g}}).done(function(c){1==c.data.status?timer=window.setInterval(b,1e3):a("#appCaptchaErr").html("图形验证码错误")}).fail(function(){c.msg("请求失败，请重试！")})}),jQuery.validator.addMethod("isPhone",function(a,b){var c=/0?(13|14|15|18)[0-9]{9}/;return this.optional(b)||c.test(a)},"请正确填写您的手机号码"),i.on("click",function(b){b.preventDefault(),a("body,html").animate({scrollTop:0},"fast")});var m=a("#registerPhoneC"),n=a("#mobilePhoneC"),o=a(".fetch-captchaC"),p=a(".img-changeC"),q=(a("#loginNamePhoneC"),a("#passwordPhoneC"),a("#appCaptchaPhoneC"));m.validate({focusInvalid:!1,errorPlacement:function(b,c){b.appendTo(a("#"+c.attr("id")+"Err"))},rules:{loginName:{required:!0,regex:/(?!^\d+$)^\w{5,25}$/,isExist:"/register/user/login-name/{0}/is-exist"},mobile:{required:!0,digits:!0,isPhone:!0,minlength:11,maxlength:11,isExist:"/register/user/mobile/{0}/is-exist"},password:{required:!0,regex:/^(?=.*[^\d])(.{6,20})$/},appCaptcha:{required:!0},captcha:{required:!0,digits:!0,maxlength:6,minlength:6,captchaVerify:{param:function(){var b=a("#mobilePhoneC").val();return"/register/user/mobile/"+b+"/captcha/{0}/verify"}}}},messages:{loginName:{required:"请输入用户名",regex:"5位至25位数字与字母下划线组合，不能全部数字",isExist:"用户名已存在"},mobile:{required:"请输入手机号",digits:"必须是数字",minlength:"手机格式不正确",isPhone:"请输入正确的手机号码",maxlength:"手机格式不正确",isExist:"手机号已存在"},password:{required:"请输入密码",regex:"6位至20位，不能全是数字"},appCaptcha:{required:"请输入验证码"},captcha:{required:"请输入手机验证码",digits:"验证码格式不正确",maxlength:"验证码格式不正确",minlength:"验证码格式不正确",captchaVerify:"验证码不正确"}},submitHandler:function(a){a.submit()}});var r=function(){a(".image-captchaC img").attr("src","/register/user/image-captcha?"+(new Date).getTime().toString())};r(),a("#appCaptchaPhoneC").on("focusout",function(b){b.preventDefault(),""!=n.val()&&/0?(13|14|15|18)[0-9]{9}/.test(n.val())&&""!=a("#appCaptchaPhoneC").val()?o.prop("disabled",!1):o.prop("disabled",!0)}),q.on("focus",function(b){a("#appCaptchaPhoneCErr").html("")}),p.on("click",function(a){a.preventDefault(),r()}),o.on("click",function(b){b.preventDefault();var e=a("#appCaptchaPhoneC").val(),f=n.val();a.ajax({url:"/register/user/send-register-captcha",type:"POST",dataType:"json",data:{imageCaptcha:e,mobile:f}}).done(function(b){1==b.data.status?timer=window.setInterval(d,1e3):a("#appCaptchaPhoneCErr").html("图形验证码错误")}).fail(function(){c.msg("请求失败，请重试！")})}),a(".show-agreement-phone").on("click",function(b){b.preventDefault(),c.open({type:1,title:"拓天速贷服务协议",area:["100%","100%"],shadeClose:!0,move:!1,scrollbar:!0,skin:"register-skin",content:a("#agreementBoxPhone")})})}()});