require(["jquery","moment","mustache","layerWrapper","text!/tpl/point-bill-table.mustache","pagination","daterangepicker","csrf"],function(a,b,c,d,e,f){a(function(){var f=a(".column-title .title-navli"),g=a("#signBtn"),h=a("#signLayer"),i=a("#closeSign"),j=a("#taskBtn"),k=a("#taskLayer"),l=a("#closeTask"),m=a("#beansDetail");f.on("click",function(b){b.preventDefault();var c=a(this),d=c.index();c.addClass("active").siblings().removeClass("active"),a(".content-list .choi-beans-list:eq("+d+")").show().siblings().hide()}),g.on("click",function(b){b.preventDefault();var c=a(this),d=a(".sign-text");$tomorrowText=a(".tomorrow-text"),$addDou=a(".add-dou"),a.ajax({url:c.data("url"),type:"POST",dataType:"json",contentType:"application/json; charset=UTF-8"}).done(function(b){b.data.status&&(d.html("签到成功，领取"+b.data.signInPoint+"财豆！"),$tomorrowText.html("明日可领"+b.data.nextSignInPoint+"财豆"),$addDou.html("+"+b.data.signInPoint),h.fadeIn("fast",function(){a(this).find(".add-dou").animate({bottom:"50px",opacity:"0"},800)}))})}),i.on("click",function(a){a.preventDefault(),location.href="/point"}),j.on("click",function(a){a.preventDefault(),k.fadeIn("fast")}),l.on("click",function(a){a.preventDefault(),k.fadeOut("fast")}),m.on("click",function(b){b.preventDefault(),a(".column-title .title-navli:eq(2)").trigger("click")});var n=b().format("YYYY-MM-DD"),o=b().subtract(1,"week").format("YYYY-MM-DD"),p=b().subtract(1,"month").format("YYYY-MM-DD"),q=b().subtract(6,"month").format("YYYY-MM-DD"),r=a(".date-filter"),s=a(".status-filter"),t=a("#date-picker"),u=a(".pagination");t.dateRangePicker({separator:" ~ "});var v=function(){var b=a(".date-filter .select-item.current").data("day");switch(b){case 1:t.val(n+"~"+n);break;case 7:t.val(o+"~"+n);break;case 30:t.val(p+"~"+n);break;case 180:t.val(q+"~"+n);break;default:t.val("")}},w=function(b){var d=t.val().split("~"),f=a.trim(d[0])||"",g=a.trim(d[1])||"",h=a(".status-filter .select-item.current").data("status"),i={startTime:f,endTime:g,businessType:h,index:b||1};u.loadPagination(i,function(b){b.status&&_.each(b.records,function(a){switch(a.businessType){case"SIGN_IN":a.businessType="签到奖励";break;case"TASK":a.businessType="任务奖励";break;case"INVEST":a.businessType="投资奖励";break;case"EXCHANGE":a.businessType="财豆兑换"}});var d=c.render(e,b);a(".point-bill-list").html(d)})};v(),w(),r.find(".select-item").click(function(){a(this).addClass("current").siblings(".select-item").removeClass("current"),v(),w()}),s.find(".select-item").click(function(){a(this).addClass("current").siblings(".select-item").removeClass("current"),w()}),a(".apply-btn").on("click",function(b){b.preventDefault(),w(),a(".date-filter .select-item").removeClass("current")}),a(".reedom-now").on("click",function(b){b.preventDefault();var c=a(this),e=c.attr("data-id"),f=c.attr("data-bite");a(this).hasClass("no-click")||d.open({title:"温馨提示",content:"确认兑换"+f+"？",btn:["确定","取消"],yes:function(b,c){d.close(b),a.ajax({url:"/point/"+e+"/exchange",type:"POST",dataType:"json"}).done(function(a){a.status?d.alert("兑换成功！",{title:"温馨提示"}):a.status||"point insufficient"!=a.message?d.alert("兑换失败，请重试！",{title:"温馨提示"}):d.open({title:"温馨提示",content:"您的财豆不足，赚取足够多的财豆后再来兑换吧！",btn:["赚取财豆","取消"],yes:function(a,b){location.href="/point"}})}).fail(function(){d.alert("兑换失败，请重试！",{title:"温馨提示"})})}})})})});