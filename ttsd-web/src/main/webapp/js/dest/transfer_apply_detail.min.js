require(["jquery","layerWrapper","jquery.validate","coupon-alert","red-envelope-float","jquery.ajax.extension","anxin_qian"],function(a,b){function c(){b.open({type:1,title:"温馨提示",btn:["确定","取消"],area:["330px","185px"],shadeClose:!0,content:'<p class="pad-m tc">是否确认转让？</p>',btn1:function(){var c=a("#transferInvestId").val();a.ajax({url:"/transfer/invest/"+c+"/is-transferable",type:"GET"}).done(function(c){if(1==c.data.status){if("true"!=k.val())return"true"==a("#isAnxinUser").val()?e():"true"==a("#skipCheck").val()?e():j.next("span.error").show(),!1;d(),b.closeAll()}else b.msg(c.message)})},btn2:function(){b.closeAll()}})}function d(){a.ajax({url:"/transfer/apply",type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify({transferAmount:100*parseFloat(a("#transferAmount").val()),transferInvestId:a("#transferInvestId").val()}),beforeSend:function(a){i.find('button[type="submit"]').prop("disabled",!0)}}).done(function(c){1==c?b.open({title:"温馨提示",btn:0,area:["400px","150px"],content:a("#successTip").html(),success:function(b,c){setInterval(function(){a(".layui-layer-content .count-time").text()<2?window.location.href="/transferrer/transfer-application-list/TRANSFERRING":a(".layui-layer-content .count-time").text(function(a,b){return parseInt(b)-1})},1e3)}}):b.msg("申请失败，请重试！")}).fail(function(){b.msg("请求失败，请重试！")}).always(function(){i.find('button[type="submit"]').prop("disabled",!1)})}function e(){b.open({shadeClose:!1,title:"安心签代签署授权",btn:0,type:1,area:["400px","auto"],content:a("#getSkipPhone")})}function f(c){a.ajax({url:"/anxinSign/sendCaptcha",type:"POST",dataType:"json",data:{isVoice:c}}).done(function(a){g(),l=setInterval(g,1e3)}).fail(function(){b.msg("请求失败，请重试或联系客服！")})}function g(){a("#getSkipCode").val(m+"秒后重新获取").prop("disabled",!0),a("#microPhone").css("visibility","hidden"),0==m?(clearInterval(l),a("#getSkipCode").val("重新获取验证码").prop("disabled",!1),a("#microPhone").css("visibility","visible"),m=60):m--}function h(){b.closeAll(),a("#skipSuccess").show(),setTimeout(function(){a("#skipSuccess").hide(),a("#skipPhoneCode").val(""),m=0,c()},3e3)}var i=a("#createForm"),j=i.find(".agreement"),k=a("#isSkipAuth");i.validate({debug:!0,rules:{price:{required:!0,max:parseFloat(a("#tipText").attr("data-max")),min:parseFloat(a("#tipText").attr("data-min"))}},onkeyup:function(){a("#tipText").removeClass("active")},errorPlacement:function(b,c){a("#tipText").addClass("active")},submitHandler:function(a){c()}}),j.find(".fa").on("click",function(){var b,c=a(this).parent();c.toggleClass("checked"),c.hasClass("checked")?(b="fa fa-check-square",c.next("span.error").hide(),a("#skipCheck").length>0&&a("#skipCheck").val("true")):(b="fa fa-square-o",a("#skipCheck").length>0&&a("#skipCheck").val("false")),c.find("i")[0].className=b}),a("#cancleBtn").on("click",function(a){a.preventDefault(),history.go(-1)}),a(".tip-item .skip-icon").on("click",function(b){b.preventDefault(),a(this).hasClass("active")?a(this).removeClass("active")&&a("#tipCheck").val("false"):a(this).addClass("active")&&a("#tipCheck").val("true")});var l,m=60;a("#getSkipCode").on("click",function(a){a.preventDefault(),f(!1)}),a("#microPhone").on("click",function(a){a.preventDefault(),f(!0)}),a("#getSkipBtn").on("click",function(c){c.preventDefault();var d=a(this);""!=a("#skipPhoneCode").val()?a.ajax({url:"/anxinSign/verifyCaptcha",type:"POST",dataType:"json",data:{captcha:a("#skipPhoneCode").val(),skipAuth:a("#tipCheck").val()}}).done(function(b){d.removeClass("active").val("立即授权").prop("disabled",!1),b.success?(a("#isAnxinUser").val("true")&&a(".skip-group").hide(),"true"==b.skipAuth&&a("#isSkipAuth").val("true"),h()):a("#skipError").text("验证码不正确").show()}).fail(function(){d.removeClass("active").val("立即授权").prop("disabled",!1),b.msg("请求失败，请重试！")}).always(function(){d.addClass("active").val("授权中...").prop("disabled",!0)}):a("#skipError").text("验证码不能为空").show()}),a("#skipPhoneCode").on("keyup",function(b){b.preventDefault(),""!=a(this).val()?a("#skipError").text("").hide():a("#skipError").text("验证码不能为空").show()})});