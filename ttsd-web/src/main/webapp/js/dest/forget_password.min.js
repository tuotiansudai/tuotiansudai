require(["jquery","layerWrapper","jquery.validate","jquery.validate.extension","jquery.form","csrf"],function(a,b){var c=a("#retrievePasswordBox"),d=a(".retrieve-form",c),e=a(".btn-send-form",c),f=a(".fetch-captcha",c),g=a(".verification-code-main"),h=a(".image-captcha-confirm",g);a(".phone-txt",c).on("focusout",function(a){f.addClass("btn").removeClass("btn-normal").prop("disabled",!0)}),d.validate({focusInvalid:!1,onkeyup:!1,rules:{mobile:{required:!0,digits:!0,minlength:11,maxlength:11,isNotExist:"/mobile-retrieve-password/mobile/{0}/is-exist?random="+(new Date).getTime()},captcha:{required:!0,digits:!0,minlength:6,maxlength:6,captchaVerify:{param:function(){var b=a('input[name="mobile"]').val(),c=a('input[name="captcha"]').val();return 6==c.length?(e.prop("disabled",!1),"/mobile-retrieve-password/mobile/"+b+"/captcha/{0}/verify?random="+(new Date).getTime()):void 0}}}},messages:{mobile:{required:"请输入手机号",digits:"必须是数字",minlength:"手机格式不正确",maxlength:"手机格式不正确",isNotExist:"手机号不存在"},captcha:{required:"请输入验证码",digits:"验证码格式不正确",minlength:"验证码格式不正确",maxlength:"验证码格式不正确",captchaVerify:"验证码不正确"}},success:function(b,d){var e=a(".disable-button",c);e.length||"mobile"!==d.name||f.addClass("btn-normal").removeClass("btn").prop("disabled",!1)},submitHandler:function(b){var c=a(".phone-txt").val(),d=a(".yzm-txt").val();window.location.href="/mobile-retrieve-password/mobile/"+c+"/captcha/"+d+"/new-password-page"}}),f.on("click",function(){return a(".verification-code-main b").hide(),a(".verification-code-text").val(""),b.open({type:1,title:"输入图形验证码",area:["380px","200px"],shadeClose:!0,offset:"146px",skin:"layer-style-custom",content:a(".verification-code-main"),success:function(a,b){i()}}),!1}),h.click(function(){var c=a(this),d=a(".phone-txt").val(),e=a(".verification-code-text").val();c.addClass("loading"),e.length<5?(a(".verification-code-main b").html("验证码不正确").show(),i()):a.ajax({url:"/mobile-retrieve-password/mobile/"+d+"/imageCaptcha/"+e+"/send-mobile-captcha",type:"get",dataType:"json",contentType:"application/json; charset=UTF-8"}).done(function(d){if(c.removeClass("loading"),d.data.status){b.closeAll();var e=30,g=setInterval(function(){f.html(e+"秒后重新发送").addClass("btn disable-button").removeClass("btn-normal").prop("disabled",!0),0==e&&(clearInterval(g),f.html("重新发送").removeClass("btn disable-button").addClass("btn-normal").prop("disabled",!1),a(".verification-code-text").val("")),e--},1e3)}else d.data.isRestricted?(a(".verification-code-main b").html("短信发送频繁，请稍后再试").show(),i()):(a(".verification-code-main b").html("验证码不正确").show(),i())})});var i=function(){var b=a(".verification-code-img");b.attr("src","/mobile-retrieve-password/image-captcha?"+(new Date).toTimeString())};a(".verification-code-img").click(function(){i()})});