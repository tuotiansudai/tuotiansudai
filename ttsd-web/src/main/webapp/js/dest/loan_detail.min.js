require(["jquery","pagination","mustache","text!/tpl/loan-invest-list.mustache","layerWrapper","csrf","autoNumeric"],function(a,b,c,d,e){function f(b){window.setInterval(function(){var c=0,d=0,e=0,f=0;1800>=b&&(b>0?(e=Math.floor(b/60)-24*c*60-60*d,f=Math.floor(b)-24*c*60*60-60*d*60-60*e):(l.prop("disabled",!1),l.html("马上投资"),k.find(".time-item").remove(),k.find(".expected-interest").parents("dd").removeClass("hide")),9>=e&&(e="0"+e),9>=f&&(f="0"+f),a("#minute_show").html(e+"分"),a("#second_show").html(f+"秒"),b--)},1e3)}function g(a){var b=o.find(":checkbox");b.is(":checked")&&h()}function h(){var a=parseFloat(p.html());Math.round(100*(a+amount))}var i=a(".loan-detail-content"),j=a(".text-input-amount",i),k=a(".account-info",i),l=a(".btn-pay",k),m=a(".loan-nav li"),n=a(".loan-list",i),o=(a("#picListBox"),a(".experience-ticket",i)),p=a(".experience-interest",i),q=a(".pagination",i),r=a(".errorTip");j.autoNumeric("init"),e.ready(function(){e.photos({photos:"#picListBox"})});var s=function(b){var e={index:b||1};q.loadPagination(e,function(b){if(b.status){var e=c.render(d,b);a(".loan-list-con table").html(e)}})};if(java_point<=50?(a(".chart-box .rount").css("webkitTransform","rotate("+3.6*java_point+"deg)"),a(".chart-box .rount2").hide()):(a(".chart-box .rount").css("webkitTransform","rotate(180deg)"),a(".chart-box .rount2").show(),a(".chart-box .rount2").css("webkitTransform","rotate("+3.6*(java_point-50)+"deg)")),n.find(".loan-list-con").eq(0).show(),m.click(function(){var b=a(this);b.addClass("active").siblings("li").removeClass("active");var c=b.index();1===c&&s(),n.find(".loan-list-con").eq(c).show().siblings(".loan-list-con").hide()}),"PREHEAT"==a("#loanStatus").val()&&f(intDiff),j.length){var t=a(".ticket-list"),u=a("#use-experience-ticket");o.is(":hidden")?a(".account-list").find("dd").last().css({"margin-top":"20px"}):o.find(":checkbox").on("click",function(){var b,c=a(this);b=c.is(":checked"),b?(o.next("dd.experience-revenue").show(),h()):o.next("dd.experience-revenue").hide()});var v=function(b){var c=a(".hid-loan").val(),d=parseFloat(j.autoNumeric("get"));isNaN(d)&&(d="0.00");var f=a("form .amountNeedRaised-i").text();if(Number(f)<Number(d)||0>=d){var h;return h=0>=d?"输入金额不能等于0!":"输入金额不能大于可投金额!",e.tips('<i class="fa fa-times-circle"></i>'+h,".text-input-amount",{tips:[1,"#ff7200"],time:0}),void l.prop("disabled",!0)}e.closeAll("tips"),l.prop("disabled",!1),t.find(".ticket-title").filter(function(b,c){return a(c).attr("data-income")>d}).parents("li").addClass("disabled"),a.ajax({url:"/calculate-expected-interest/loan/"+c+"/amount/"+d,type:"get",dataType:"json",contentType:"application/json; charset=UTF-8"}).done(function(a){b||e.closeAll("tips"),g(a),l.prop("disabled",!1)})};"undefined"!=typeof user_can_invest&&v(!0),j.blur(function(){v(!1)}),j.keypress(function(a){t.find("input").prop("checked",!1),u.find("span").text("请点击选择优惠券")}),a("form").submit(function(){var b=a(this);if("/invest"===b.attr("action")){if("undefined"==typeof user_can_invest)return location.href="/login?redirect="+encodeURIComponent(location.href),!1;var c=parseFloat(j.autoNumeric("get"));if(isNaN(parseFloat(c)))return!1;var d=parseFloat(a("form .account-amount").text());return c>d?(location.href="/recharge",!1):(j.val(c),!0)}return!0}),u.click(function(b){var c=a(this);return c.hasClass("disabled")?!1:(t.toggleClass("hide"),c.find(".fa-sort-down").toggleClass("hide").siblings(".fa-sort-up").toggleClass("hide"),void(b.stopPropagation?b.stopPropagation():window.event&&(window.event.cancelBubble=!0)))}),t.find("input").click(function(b){var c=a.trim(a(b.target).next().find(".ticket-title").text());u.find("span").text(c)}),a("body").click(function(b){var c=b||window.event,d=c.srcElement||c.target;t.hasClass("hide")||0!=a(d).parents(".ticket-list").length||t.addClass("hide")}),a("#use-experience-ticket").click(function(b){var c=a(this),d=this.value,f=c.prop("checked"),g=parseFloat(j.autoNumeric("get"));f&&a.ajax({url:"/coupon-is-available/coupon/"+d+"/amount/"+g,type:"get",dataType:"json",contentType:"application/json; charset=UTF-8"}).done(function(b){b||(c.prop("checked",!1),e.tips('<i class="fa fa-times-circle"></i>投资金额不少于'+c.attr("data-amount")+"才可使用此劵",".experience-ticket",{tips:[1,"#ff7200"],time:0}),a(".experience-revenue").hide())})})}r.length&&e.tips('<i class="fa fa-times-circle"></i>'+r.text(),".text-input-amount",{tips:[1,"#ff7200"],time:0})});