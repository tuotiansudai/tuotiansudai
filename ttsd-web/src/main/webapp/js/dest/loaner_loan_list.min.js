require(["jquery","mustache","text!tpl/loaner-loan-table.mustache","text!tpl/loaner-loan-repay-table.mustache","moment","underscore","layerWrapper","daterangepicker","jquery.ajax.extension","pagination"],function(a,b,c,d,e,f,g){function h(e){var h=m.val().split("~"),i=a.trim(h[0])||"",j=a.trim(h[1])||"",k=a(".status-filter .select-item.current").data("status"),l={startTime:i,endTime:j,status:k,index:e||1};n.loadPagination(l,function(e){switch(k){case"REPAYING":e.isRepaying=!0;break;case"COMPLETE":e.isComplete=!0;break;case"CANCEL":e.isCancel=!0}var h=b.render(c,e);a(".loan-list-content .loan-list").html(h),a(".loan-list .show-loan-repay").click(function(){a.ajax({url:a(this).data("url"),type:"get",dataType:"json",contentType:"application/json; charset=UTF-8"}).success(function(c){var e=c.data;if(e.csrfToken=a("meta[name='_csrf']").attr("content"),e.status){e.isLoanCompleted=f.every(e.records,function(a){return"COMPLETE"===a.loanRepayStatus}),f.each(e.records,function(a){switch(a.loanRepayStatus){case"REPAYING":a.status=a.isEnabled?"还款":"待还";break;case"COMPLETE":a.status="完成";break;case"CANCEL":a.status="流标";break;case"WAIT_PAY":a.status="等待支付";break;case"OVERDUE":a.status=a.isEnabled?"逾期还款":"逾期"}});var h=b.render(d,e);g.open({type:1,title:!1,offset:"100px",area:["850px"],shadeClose:!0,content:h}),e.isNormalRepayEnabled&&a("a.normal-repay").click(function(){return parseFloat(e.loanerBalance)<parseFloat(e.normalRepayAmount)?(p(e.loanerBalance,e.normalRepayAmount),!1):(a("#normal-repay-form").submit(),g.closeAll(),!1)}),e.isAdvanceRepayEnabled&&a("a.advanced-repay").click(function(){return parseFloat(e.loanerBalance)<parseFloat(e.advanceRepayAmount)?(p(e.loanerBalance,e.advanceRepayAmount),!1):(a("#advanced-repay-form").submit(),g.closeAll(),!1)})}})})})}var i=e().format("YYYY-MM-DD"),j=e().subtract(1,"week").format("YYYY-MM-DD"),k=e().subtract(1,"month").format("YYYY-MM-DD"),l=e().subtract(6,"month").format("YYYY-MM-DD"),m=a("#date-picker"),n=a(".pagination");m.dateRangePicker({separator:" ~ "}).val(i+"~"+i);var o=function(){var b=a(".date-filter .select-item.current").data("day");switch(b){case 1:m.val(i+"~"+i);break;case 7:m.val(j+"~"+i);break;case 30:m.val(k+"~"+i);break;case 180:m.val(l+"~"+i);break;default:m.val("")}};a(".date-filter .select-item").click(function(){a(this).addClass("current").siblings(".select-item").removeClass("current"),o(),h()}),a(".date-filter .select-item").eq(2).trigger("click"),a(".status-filter .select-item").click(function(){a(this).addClass("current").siblings(".select-item").removeClass("current"),h()}),h(),a(".apply-btn").click(function(){h(),a(".date-filter .select-item").removeClass("current")});var p=function(a,c){g.closeAll(),g.open({type:1,closeBtn:0,skin:"demo-class",shadeClose:!1,title:"账户余额不足",btn:["关闭","去充值"],area:["400px","160px"],content:b.render('<p class="pad-m-tb tc">应还金额 {{repayAmount}} 元，您的账户余额仅有 {{balance}} 元</p>',{repayAmount:c,balance:a}),btn1:function(){g.closeAll()},btn2:function(){window.location.href="/recharge"}})}});