require(["jquery","layerWrapper","jquery.validate","jquery.validate.extension","jquery.form","jquery.ajax.extension","csrf"],function(a,b){var c,d=a("#personInfoBox"),e=a(".setEmail",d),f=a(".setTurnOnNoPasswordInvest",d),g=a(".setTurnOffNoPasswordInvest",d),h=a(".setPass",d),i=a(".setUmpayPass",d),j=a("#changeEmailDOM"),k=a(".setNoPasswordInvest"),l=a("#turnOnNoPasswordInvestDOM"),m=a("#turnOffNoPasswordInvestDOM"),n=a("#noPasswordInvestDOM"),o=a(".image-captcha",m),p=a(".image-captcha-text",m),q=a(".get-captcha"),r=a(".btn-cancel",m),s=a(".btn-close-turn-on",l),t=a(".btn-close-turn-off",m),u=a(".btn-turn-on",l),v=a(".code-number"),w=a("#changePassDOM"),x=a("#resetUmpayPassDOM"),y=a("#successUmpayPass"),z=a("form",j),A=a("form",w),B=a("form",x),C=a("#turnOffNoPasswordInvestForm",m),D=a("#imageCaptchaForm",m),E=a("#update-bank-card");E.on("click",function(){var c=a(this).attr("data-url");a.ajax({url:"/bind-card/is-replacing",type:"GET",dataType:"json"}).done(function(d){d?b.open({type:1,title:!1,area:["400px","120px"],btn:["确定"],shadeClose:!0,content:'<p class="tc" style="margin-top:20px;">您已经提交了更换银行卡申请，请耐心等待结果。</p>',btn1:function(){b.closeAll()}}):a.ajax({url:"/bind-card/is-manual",type:"GET",dataType:"json"}).done(function(a){a?b.open({type:1,title:!1,area:["600px","180px"],btn:["我已联系客服，确认更换"],shadeClose:!0,content:'<p class="tc" style="margin-top:20px;line-height:20px">您的账户余额或待收本息不为0，为了您的资金安全，请先联系客服<br />并提交相关材料后再点击更换，否则无法更换成功。</p><p class="tc" style="margin-top:20px;line-height:20px">客服电话：400-169-1188（服务时间：9:00－20:00）</p>',btn1:function(){location.href=c}}):location.href=c}).fail(function(){b.msg("请求失败，请重试！")})}).fail(function(){b.msg("请求失败，请重试！")})}),e.on("click",function(){b.open({type:1,move:!1,offset:"200px",title:"绑定邮箱",area:["490px","220px"],shadeClose:!0,content:j,cancel:function(){z.validate().resetForm()}})}),f.on("click",function(){a.ajax({url:"/checkLogin",type:"get",dataType:"json",contentType:"application/json; charset=UTF-8"}).done(function(a){b.open({type:1,move:!1,offset:"200px",title:"免密投资",area:["490px","220px"],shadeClose:!1,closeBtn:0,content:l})})}),t.on("click",function(){cnzzPush.trackClick("个人资料页","关闭免密弹框","我要关闭")}),g.on("click",function(){a.ajax({url:"/checkLogin",type:"get",dataType:"json",contentType:"application/json; charset=UTF-8"}).done(function(a){a&&(F(),b.open({type:1,move:!1,area:"500px",title:"免密投资",closeBtn:0,shadeClose:!1,content:m}))})});var F=function(){clearInterval(c),q.html("获取验证码").prop("disabled",!0),G(),a(".captcha").val(""),a(".error-content").html(""),v.addClass("code-number-hidden")};q.on("click",function(){D.submit()}),k.on("click",function(){cnzzPush.trackClick("个人资料页","开启免密投资","直接开启");var b=a(this);a.ajax({url:b.data("url"),type:"POST",dataType:"json",contentType:"application/json; charset=UTF-8"}).done(function(a){a.data.status&&(location.href="/personal-info")})}),r.on("click",function(){b.closeAll()}),s.on("click",function(){cnzzPush.trackClick("个人资料页","开启免密弹框","取消"),b.closeAll()}),u.on("click",function(){cnzzPush.trackClick("个人资料页","开启免密弹框","去联动优势授权"),b.closeAll(),b.open({type:1,closeBtn:0,move:!1,offset:"200px",title:"免密投资",area:["490px","220px"],shadeClose:!0,content:n})}),D.validate({focusInvalid:!1,onFocusOut:function(a){this.checkable(a)||this.optional(a)||this.element(a)},success:function(b){b.remove(),a("#turnOffNoPasswordInvestDOM").find(".get-captcha").prop("disabled",!1)},errorPlacement:function(b,c){var d=a(".error-content");d.html(""),b.appendTo(d),a("#turnOffNoPasswordInvestDOM").find(".get-captcha").prop("disabled",!0)},submitHandler:function(b){var d=this;a(b).ajaxSubmit({data:{mobile:a(".mobile").val()},dataType:"json",success:function(a){var b=a.data;if(b.status&&!b.isRestricted){v.removeClass("code-number-hidden");var e=60;return void(c=setInterval(function(){q.html(e+"秒后重新发送").addClass("btn disable-button").removeClass("btn-normal").prop("disabled",!0),0==e&&(clearInterval(c),q.html("重新发送").removeClass("btn disable-button").addClass("btn-normal").prop("disabled",!1),G()),e--},1e3))}!b.status&&b.isRestricted&&(v.addClass("code-number-hidden"),d.showErrors({imageCaptcha:"短信发送频繁，请稍后再试"})),b.status||b.isRestricted||(v.addClass("code-number-hidden"),d.showErrors({imageCaptcha:"图形验证码不正确"})),d.invalid.imageCaptcha=!0,G()},error:function(){d.invalid.imageCaptcha=!0,d.showErrors({imageCaptcha:"图形验证码不正确"}),G()}})},rules:{imageCaptcha:{required:!0,regex:/^[a-zA-Z0-9]{5}$/}},messages:{imageCaptcha:{required:"请输入图形验证码",regex:"图形验证码位数不对"}}}),C.validate({focusInvalid:!1,ignore:".image-captcha-text",rules:{captcha:{required:!0,digits:!0,maxlength:6,minlength:6,captchaVerify:{param:function(){var b=a('input[name="mobile"]').val();return"/no-password-invest/mobile/"+b+"/captcha/{0}/verify"}}}},messages:{captcha:{required:"请输入验证码",digits:"验证码格式不正确",maxlength:"验证码格式不正确",minlength:"验证码格式不正确",captchaVerify:"验证码不正确"}},errorPlacement:function(b,c){var d=a(".error-content");d.html(""),b.appendTo(d),a("#turnOffNoPasswordInvestDOM").find(".get-captcha").prop("disabled",!0)},submitHandler:function(b){a(b).ajaxSubmit({success:function(a){var b=a.data;b.status&&(location.href="/personal-info")}})}}),z.validate({focusInvalid:!1,rules:{email:{required:!0,regex:/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/,email:!0,isExist:"/personal-info/email/{0}/is-exist"}},onFocusOut:function(b,c){var d=[16,17,18,20,35,36,37,38,39,40,45,144,225];9===c.which&&""===this.elementValue(b)||-1!==a.inArray(c.keyCode,d)||this.element(b),this.checkable(b)||this.optional(b)||this.element(b)},messages:{email:{required:"请输入有效邮箱",regex:"请输入有效邮箱",isExist:"邮箱已存在",email:"请输入有效邮箱"}},success:"valid",submitHandler:function(c){return a(c).ajaxSubmit({dataType:"json",beforeSubmit:function(c,d,e){a(".change-email-success .email").html(a('input[name="email"]').val()),d.resetForm(),b.closeAll()},success:function(c){var d=c.data;d.status?b.open({type:1,title:"验证邮箱",area:["500px","220px"],shadeClose:!0,content:a("#change-email-success"),btn:["返回"],yes:function(a,c){b.close(a)}}):b.msg("邮箱绑定失败，请重试！",{type:1,time:2e3})},error:function(){b.msg("邮箱绑定失败，请重试！",{type:1,time:2e3})},complete:function(){}}),!1}}),h.on("click",function(){b.open({type:1,move:!1,offset:"200px",title:"修改密码",area:["500px","300px"],shadeClose:!1,content:w,cancel:function(){A.validate().resetForm()}})}),A.validate({focusCleanup:!0,focusInvalid:!1,onkeyup:function(b,c){var d=[16,17,18,20,35,36,37,38,39,40,45,144,225];9===c.which&&""===this.elementValue(b)||-1!==a.inArray(c.keyCode,d)||this.element(b)},onFocusOut:function(a){this.checkable(a)||this.optional(a)||this.element(a)},submitHandler:function(c){var d=this;return a(c).ajaxSubmit({dataType:"json",beforeSubmit:function(a,c,e){d.resetForm(),b.closeAll()},success:function(c){var d=c.data;d.status?b.msg("密码修改成功，请重新登录！",{type:1,time:2e3},function(){a(".header .logout-form").submit()}):b.msg("密码修改失败，请重试！",{type:1,time:2e3})},error:function(){b.msg("密码修改失败，请重试！",{type:1,time:2e3})},complete:function(){}}),!1},rules:{originalPassword:{required:!0,rangelength:[6,20],regex:/^(?=.*[^\d])(.{6,20})$/,isNotExist:"/personal-info/password/{0}/is-exist"},newPassword:{required:!0,rangelength:[6,20],regex:/^(?=.*[^\d])(.{6,20})$/},newPasswordConfirm:{required:!0,rangelength:[6,20],regex:/^(?=.*[^\d])(.{6,20})$/,equalTo:"input[name='newPassword']"}},messages:{originalPassword:{required:"请输入原密码",rangelength:"长度6~20位",regex:"不能全为数字",isNotExist:"原密码不正确"},newPassword:{required:"请输入新密码",rangelength:"长度6~20位",regex:"不能全为数字"},newPasswordConfirm:{required:"请输入新密码",rangelength:"长度6~20位",regex:"不能全为数字",equalTo:"密码不一致"}}}),i.on("click",function(){b.open({type:1,move:!1,offset:"200px",title:"修改支付密码",area:["500px","300px"],shadeClose:!1,content:x,cancel:function(){B.validate().resetForm(),a(".identityCodeTitle").show(),a(".identityCodeError").hide()}})}),B.validate({submitHandler:function(c){var d=this;return a(c).ajaxSubmit({dataType:"json",beforeSubmit:function(a,b,c){d.resetForm()},success:function(c){var d=c.data;d.status?(b.closeAll(),b.open({type:1,move:!1,offset:"200px",title:"修改支付密码",area:["500px","300px"],shadeClose:!1,content:y})):(a(".identityCodeTitle").hide(),a(".identityCodeError").show())},error:function(){a(".identityCodeTitle").hide(),a(".identityCodeError").show()},complete:function(){}}),!1},rules:{identityNumber:{required:!0}},messages:{identityNumber:{required:"请输入身份证"}}});var G=function(){o.attr("src","/no-password-invest/image-captcha?"+(new Date).getTime().toString()),p.val("")};o.click(function(){G()}),a("#readUmpayPass").on("click",function(){b.closeAll()})});