require(["jquery","layer","jquery.validate","jquery.validate.extension","jquery.form"],function(a,b){a(function(){var c=a("#personInfoBox"),d=a(".setEmail",c),e=a(".setPass",c),f=a("#changeEmailDOM"),g=a("#changePassDOM"),h=a("form",f),i=a("form",g);d.on("click",function(){b.open({type:1,move:!1,offset:"200px",title:"绑定邮箱",area:["490px","220px"],shadeClose:!0,content:f,cancel:function(){i.validate().resetForm()}})}),h.validate({success:"form-valid",focusInvalid:!1,errorClass:"form-error",rules:{email:{required:!0,email:!0,isExist:"/personal-info/email/{0}/is-exist"}},onkeyup:function(b,c){var d=[16,17,18,20,35,36,37,38,39,40,45,144,225];9===c.which&&""===this.elementValue(b)||-1!==a.inArray(c.keyCode,d)||this.element(b)},onFocusOut:function(a){this.checkable(a)||this.optional(a)||this.element(a)},messages:{email:{required:"请输入有效邮箱",email:"请输入有效邮箱",isExist:"邮箱已存在"}},submitHandler:function(c){var d=this;return a(c).ajaxSubmit({dataType:"json",beforeSubmit:function(c,e,f){a(".change-email-success .email").html(a('input[name="email"]').val()),d.resetForm(),b.closeAll()},success:function(c){var d=c.data;d.status?b.open({type:1,title:"验证邮箱",area:["500px","220px"],shadeClose:!0,content:a("#change-email-success"),btn:["返回"],yes:function(a,c){b.close(a)}}):b.msg("邮箱绑定失败，请重试！",{type:1,time:2e3})},error:function(){b.msg("邮箱绑定失败，请重试！",{type:1,time:2e3})},complete:function(){}}),!1}}),e.on("click",function(){b.open({type:1,move:!1,offset:"200px",title:"修改密码",area:["500px","300px"],shadeClose:!1,content:g,cancel:function(){i.validate().resetForm()}})}),i.validate({focusCleanup:!0,success:"form-valid",focusInvalid:!1,errorClass:"form-error",onkeyup:function(b,c){var d=[16,17,18,20,35,36,37,38,39,40,45,144,225];9===c.which&&""===this.elementValue(b)||-1!==a.inArray(c.keyCode,d)||this.element(b)},onFocusOut:function(a){this.checkable(a)||this.optional(a)||this.element(a)},submitHandler:function(c){var d=this;return a(c).ajaxSubmit({dataType:"json",beforeSubmit:function(a,c,e){d.resetForm(),b.closeAll()},success:function(c){var d=c.data;d.status?b.msg("密码修改成功，请重新登录！",{type:1,time:2e3},function(){a(".header .logout-form").submit()}):b.msg("密码修改失败，请重试！",{type:1,time:2e3})},error:function(){b.msg("密码修改失败，请重试！",{type:1,time:2e3})},complete:function(){}}),!1},rules:{originalPassword:{required:!0,rangelength:[6,20],regex:"^(?=.*[0-9])(?=.*[a-zA-Z])([a-zA-Z0-9]+)$",isNotExist:"/personal-info/password/{0}/is-exist"},newPassword:{required:!0,rangelength:[6,20],regex:"^(?=.*[0-9])(?=.*[a-zA-Z])([a-zA-Z0-9]+)$"},newPasswordConfirm:{required:!0,rangelength:[6,20],regex:"^(?=.*[0-9])(?=.*[a-zA-Z])([a-zA-Z0-9]+)$",equalTo:"input[name='newPassword']"}},messages:{originalPassword:{required:"请输入原密码",rangelength:"长度6~20位",regex:"字母和数字组合",isNotExist:"原密码不正确"},newPassword:{required:"请输入新密码",rangelength:"长度6~20位",regex:"字母和数字组合"},newPasswordConfirm:{required:"请输入新密码",rangelength:"长度6~20位",regex:"字母和数字组合",equalTo:"密码不一致"}}})})});