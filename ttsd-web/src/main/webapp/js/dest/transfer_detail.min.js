require(["jquery","pagination","layerWrapper","coupon-alert","red-envelope-float","jquery.ajax.extension","logintip","anxin_qian"],function(a,b,c){function d(a){c.msg(a)}function e(){var b=parseInt(a("#transferInvestId").val()),d=a("#amount").val(),e=a("#userBalance").val(),g=a(".transfer-detail-content");a.ajax({url:"/transfer/"+b+"/purchase-check",type:"GET",dataType:"json"}).done(function(b){"SUCCESS"==b.message?c.open({title:"温馨提示",btn:["确定"],content:"该项目已被承接，请选择其他项目。",btn1:function(a,b){c.closeAll(),location.href="/transfer-list"}}):"CANCEL"==b.message?c.open({title:"温馨提示",btn:["确定"],content:"该项目已被取消，请选择其他项目。",btn1:function(a,b){c.closeAll(),location.href="/transfer-list"}}):"MULTITERM"==b.message?c.open({title:"温馨提示",btn:["确定"],content:"该项目已被承接或已取消，请选择其他项目。",btn1:function(a,b){c.closeAll(),location.href="/transfer-list"}}):c.open({type:1,closeBtn:0,skin:"demo-class",title:"投资提示",shadeClose:!1,btn:["取消","确认"],area:["300px","160px"],content:'<p class="pad-m-tb tc">确认投资？</p>',btn1:function(){c.closeAll()},btn2:function(){var b=a("#transferForm");if("/transfer/purchase"===b.attr("action")){var c="INVESTOR"===g.data("user-role");if(!c)return location.href="/login?redirect="+encodeURIComponent(location.href),!1;var h=parseInt((100*e).toFixed(0))||0;if(parseInt((100*d).toFixed(0))>h)return location.href="/recharge",!1}return"false"!=n.val()?(f(),!1):void b.submit()}})}).fail(function(){c.msg("请求失败")})}function f(){c.open({shadeClose:!1,title:"安心签代签署授权",btn:0,type:1,area:["400px","auto"],content:a("#getSkipPhone")})}function g(b){a("#getSkipCode").prop("disabled",!0),a("#microPhone").css("visibility","hidden"),a.ajax({url:"/anxinSign/sendCaptcha",type:"POST",dataType:"json",data:{isVoice:b}}).done(function(b){a("#getSkipCode").prop("disabled",!1),a("#microPhone").css("visibility","visible"),b.success?(h(),o=setInterval(h,1e3)):c.msg("请求失败，请重试或联系客服！")}).fail(function(){a("#getSkipCode").prop("disabled",!1),a("#microPhone").css("visibility","visible"),c.msg("请求失败，请重试或联系客服！")})}function h(){a("#getSkipCode").val(p+"秒后重新获取").prop("disabled",!0),a("#microPhone").css("visibility","hidden"),0==p?(clearInterval(o),a("#getSkipCode").val("重新获取验证码").prop("disabled",!1),a("#microPhone").css("visibility","visible"),p=60):p--}function i(){c.closeAll(),a("#skipSuccess").show(),setTimeout(function(){a("#skipSuccess").hide(),a("#skipPhoneCode").val(""),p=0,a("#transferForm").submit()},3e3)}var j=a(".transfer-detail-content"),k=a(".errorTip",j),l=a(".question-list",j),m=a(".detail-record",j),n=a("#isAnxinAuthenticationRequired");m.find("li").on("click",function(){var b=a(this),c=b.index();b.addClass("active").siblings("li").removeClass("active"),a(".detail-record-info",j).eq(c).show().siblings(".detail-record-info").hide()}),k.length>0&&""!=k.text()&&d(k.text()),a("#transferSubmit").on("click",function(b){b.preventDefault(),a.ajax({url:"/isLogin",type:"GET",dataType:"json",contentType:"application/json; charset=UTF-8"}).fail(function(b){if(""==b.responseText)return void e();a("meta[name='_csrf']").remove(),a("head").append(a(b.responseText));var d=a("meta[name='_csrf']").attr("content"),f=a("meta[name='_csrf_header']").attr("content");a(document).ajaxSend(function(a,b,c){b.setRequestHeader(f,d)}),c.open({type:1,title:!1,closeBtn:0,area:["auto","auto"],content:a("#loginTip")}),a(".image-captcha img").trigger("click")})}),l.find("dl dd").hide(),l.find("dl dd").eq(0).show(),l.find("dl dt").eq(0).find("i").addClass("fa-chevron-circle-up").removeClass("fa-chevron-circle-down"),l.find("dt").on("click",function(b){var c=a(this);c.next("dd").toggle(),c.next("dd").is(":hidden")?c.find("i").removeClass("fa-chevron-circle-up").addClass("fa-chevron-circle-down"):c.find("i").addClass("fa-chevron-circle-up").removeClass("fa-chevron-circle-down")}),a(".skip-group .skip-icon").on("click",function(b){b.preventDefault(),a(this).hasClass("active")?a(this).removeClass("active")&&a("#skipCheck").val("false")&&a("#checkTip").show()&&a("#transferSubmit").prop("disabled",!0):a(this).addClass("active")&&a("#skipCheck").val("true")&&a("#checkTip").hide()&&a("#transferSubmit").prop("disabled",!1)}),a(".tip-item .skip-icon").on("click",function(b){b.preventDefault(),a(this).hasClass("active")?a(this).removeClass("active")&&a("#tipCheck").val("false"):a(this).addClass("active")&&a("#tipCheck").val("true")});var o,p=60;a("#getSkipCode").on("click",function(a){a.preventDefault(),g(!1)}),a("#microPhone").on("click",function(a){a.preventDefault(),g(!0)}),a("#getSkipBtn").on("click",function(b){b.preventDefault();var d=a(this);""!=a("#skipPhoneCode").val()?a.ajax({url:"/anxinSign/verifyCaptcha",type:"POST",dataType:"json",data:{captcha:a("#skipPhoneCode").val(),skipAuth:a("#tipCheck").val()}}).done(function(b){d.removeClass("active").val("立即授权").prop("disabled",!1),b.success?(a("#isAnxinUser").val("true"),"skipAuth"==b.data.message&&n.val("false"),a(".skip-group").hide(),i()):a("#skipError").text("验证码不正确").show()}).fail(function(){d.removeClass("active").val("立即授权").prop("disabled",!1),c.msg("请求失败，请重试！")}).always(function(){d.addClass("active").val("授权中...").prop("disabled",!0)}):a("#skipError").text("验证码不能为空").show()}),a("#skipPhoneCode").on("keyup",function(b){b.preventDefault(),""!=a(this).val()?a("#skipError").text("").hide():a("#skipError").text("验证码不能为空").show()})});