require(["jquery","underscore","jquery.ajax.extension","jquery.validate","jquery.form"],function(a,b){var c=a(".form-login"),d=a(".login-submit",c),e=a(".login-name",c),f=a(".password",c),g=a(".captcha",c),h=a(".error",c),i=a(".image-captcha img",c),j=function(){g.val(""),i.attr("src","/login/captcha?"+(new Date).getTime().toString())};i.click(function(){j()}),e.blur(function(b){return h.text("").css("visibility","hidden"),""===a.trim(e.val())?(h.text("用户名不能为空").css("visibility","visible"),!1):!1}),f.blur(function(b){return h.text("").css("visibility","hidden"),""===a.trim(f.val())&&h.text("密码不能为空").css("visibility","visible"),!1}),g.blur(function(b){return h.text("").css("visibility","hidden"),""===a.trim(g.val())&&h.text("验证码不能为空").css("visibility","visible"),!1});var k=function(){return h.text("").css("visibility","hidden"),""===a.trim(e.val())?(h.text("用户名不能为空").css("visibility","visible"),!1):""===a.trim(f.val())?(h.text("密码不能为空").css("visibility","visible"),!1):""===a.trim(g.val())?(h.text("验证码不能为空").css("visibility","visible"),!1):!0},l=function(){return c.ajaxSubmit({beforeSubmit:function(a,b,c){d.addClass("loading")},success:function(a){var e=a.data;if(e.status)window.location.href=b.difference(e.roles,["USER"]).length>0?c.data("redirect-url"):"/register/account";else{if(j(),d.removeClass("loading"),e.isLocked)return void h.text("用户已被锁定").css("visibility","visible");if(e.isCaptchaNotMatch)return void h.text("验证码不正确").css("visibility","visible");h.text("用户或密码不正确").css("visibility","visible")}},error:function(){d.removeClass("loading"),j(),h.text("用户或密码不正确").css("visibility","visible")}}),!1};d.click(function(){k()&&l()}),a(document).keypress(function(a){var b=a.keyCode?a.keyCode:a.which;13===b&&k()&&(d.focus(),l())})});