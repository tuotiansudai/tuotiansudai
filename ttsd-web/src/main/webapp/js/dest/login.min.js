require(["jquery","csrf","jquery.validate","jquery.form","commonFun"],function(a){var b=a(".form-login"),c=a(".login-submit",b),d=a(".login-name",b),e=a(".password",b),f=a(".captcha",b),g=a(".error",b),h=a(".image-captcha img",b);String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")};var i=function(){f.val(""),h.attr("src","/login/captcha?"+(new Date).getTime().toString())};h.click(function(){i()}),d.blur(function(a){return g.text("").css("visibility","hidden"),""===d.val().trim()?(g.text("用户名不能为空").css("visibility","visible"),!1):!1}),e.blur(function(a){return g.text("").css("visibility","hidden"),""===e.val().trim()&&g.text("密码不能为空").css("visibility","visible"),!1}),f.blur(function(a){return g.text("").css("visibility","hidden"),""===f.val().trim()&&g.text("验证码不能为空").css("visibility","visible"),!1});var j=function(){return g.text("").css("visibility","hidden"),""===d.val().trim()?(g.text("用户名不能为空").css("visibility","visible"),!1):""===e.val().trim()?(g.text("密码不能为空").css("visibility","visible"),!1):""===f.val().trim()?(g.text("验证码不能为空").css("visibility","visible"),!1):!0},k=function(){return b.ajaxSubmit({beforeSubmit:function(a,b,d){c.toggleClass("loading")},success:function(a){if(a.data.status)window.location.href=b.data("redirect-url");else{if(i(),a.data.isLocked)return void g.text("用户已被锁定").css("visibility","visible");if(a.data.isCaptchaNotMatch)return void g.text("验证码不正确").css("visibility","visible");g.text("用户或密码不正确").css("visibility","visible")}},error:function(){i(),g.text("用户或密码不正确").css("visibility","visible")},complete:function(){c.toggleClass("loading")}}),!1};c.click(function(){j()&&k()}),a(document).keypress(function(a){var b=a.keyCode?a.keyCode:a.which;13===b&&j()&&(c.focus(),k())})});