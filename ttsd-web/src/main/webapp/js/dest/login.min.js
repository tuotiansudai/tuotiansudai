require(["jquery","underscore","jquery.ajax.extension","jquery.validate","jquery.form"],function(a,b){!function(){function c(){h.val(""),j.attr("src","/login/captcha?"+(new Date).getTime().toString())}function d(c){return c.each(function(c,d){var e,f=d.name,g=a.trim(d.value);switch(k=!0,f){case"username":if(b.isEmpty(g))e="用户名不能为空",k=!1;else{for(var h=0,j=0;j<g.length;j++)0!=(65280&g.charCodeAt(j))&&h++,h++;h.length<5&&(e="用户名输入太短",k=!1),h.length>25&&(e="用户名输入太长",k=!1)}break;case"password":b.isEmpty(g)?(e="密码不能为空",k=!1):/^(?=.*[^\d])(.{6,20})$/.test(g)||(e="密码为6位至20位，不能全是数字",k=!1);break;case"captcha":b.isEmpty(g)&&(e="验证码不能为空",k=!1)}k||i.text(e).css("visibility","visible")}),k}var e=a("#loginContainer"),f=a(".form-login",e),g=a(".login-submit",f),h=a(".captcha",f),i=a(".error",f),j=a(".image-captcha img",f),k=!0;c(),j.click(function(){c()}),f.find("input:text,input:password").on("blur",function(b){var c=a(this);i.text("").css("visibility","hidden"),d(c)});var l=function(){return f.ajaxSubmit({beforeSubmit:function(a,b,c){g.addClass("loading")},success:function(a){a.status?window.location.href=b.difference(a.roles,["USER"]).length>0?f.data("redirect-url"):"/register/account":(c(),g.removeClass("loading"),i.text(a.message).css("visibility","visible"))},error:function(){g.removeClass("loading"),c(),i.text("用户或密码不正确").css("visibility","visible")}}),!1};g.click(function(a){return a.preventDefault(),k=d(f.find("input:text,input:password")),k&&l(),!1}),a(document).keypress(function(a){var b=a.keyCode?a.keyCode:a.which;13===b&&(k=d(f.find("input:text,input:password")),k&&(g.focus(),a.preventDefault(),l()))})}()});