require(["jquery","mustache","text!/tpl/transfer-transferable-table.mustache","text!/tpl/transferrer-transfer-application-table.mustache","text!/tpl/transferrer-transfer-record-table.mustache","pagination","layerWrapper","jquery.ajax.extension"],function(a,b,c,d,e,f,g){a(function(){function f(f){var j=a(".filters-list li.active").attr("data-status").split(","),k={status:j,index:f||1};i.loadPagination(k,function(f){if(0==h)var g=b.render(c,f);else if(1==h)var g=b.render(d,f);else var g=b.render(e,f);a(".list-container .record-list.active").html(g)}),a(".list-container").on("mouseenter",".project-name",function(){g.closeAll("tips"),a.trim(a(this).text()).length>15&&g.tips(a(this).text(),a(this),{tips:[1,"#efbf5c"],time:2e3,tipsMore:!0,area:"auto",maxWidth:"500"})})}var h=a(".filters-list li.active").index(),i=a(".pagination");f(),a("body").on("click",".cancel-btn",function(b){b.preventDefault();var c=a(this),d=c.attr("data-link");g.open({title:"温馨提示",btn:["再想想","确定"],skin:"demo-class",area:["400px","180px"],content:'<p class="tc">该项目即将在X日内回款，暂不可转让，<br />请选择其他项目。</p>',btn1:function(){g.closeAll()},btn2:function(){a.ajax({url:"/transfer/application/"+d+"/cancel",type:"POST",dataType:"json"}).done(function(a){1==a?location.reload():g.msg("取消失败，请重试！")}).fail(function(){g.msg("请求失败，请重试！")})}})}).on("click",".apply-transfer",function(b){b.preventDefault();var c=a(this),d=c.attr("data-applyId"),e=c.attr("data-link");a.ajax({url:"/transfer/application/"+e+"/isNearRepayDate",type:"POST",dataType:"json"}).done(function(b){1==b.status?a.ajax({url:"/transfer/application/"+d+"/apply",type:"POST",dataType:"json"}).done(function(a){location.href="/transfer/apply"}).fail(function(a){g.msg("申请失败，请重试！")}):g.open({title:"温馨提示",btn:["确定"],area:["400px","180px"],content:'<p class="tc">'+b.message+"</p>",btn1:function(){g.closeAll()}})}).fail(function(){g.msg("请求失败，请重试！")})})})});