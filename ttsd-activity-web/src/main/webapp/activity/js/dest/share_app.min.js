require(["jquery","layerWrapper","underscore","jquery.validate","jquery.validate.extension","jquery.ajax.extension"],function(a,b,c){a(function(){!!a("#shareAPP")&&cnzzPush.trackClick("208APP分享","注册或者预注册成功页面","页面加载");var c={versions:function(){var a=navigator.userAgent;navigator.appVersion;return{ios:!!a.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:a.indexOf("Android")>-1||a.indexOf("Adr")>-1}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()};c.versions.ios&&cnzzPush.trackClick("203APP分享","分享链接IOS","页面加载"),c.versions.android&&cnzzPush.trackClick("202APP分享","分享链接ANDROID","页面加载");var d=a("#androidForm"),e=a("#iosForm"),f=a("#androidBtn"),g=a("#iosBtn"),h=60,i={androidCount:function(){timer=setInterval(function(){f.prop("disabled",!0).val(h+"s"),h--,0==h&&(clearInterval(timer),h=60,f.prop("disabled",!1).val("重新发送"))},1e3)},anCaptcha:function(c){if(0==c)a.ajax({url:"/register/user/"+a("#mobile").val()+"/send-register-captcha",type:"get",dataType:"json"}).done(function(a){a.data.status&&!a.data.isRestricted?i.androidCount():!a.data.status&&a.data.isRestricted&&b.msg("短信发送频繁,请稍后再试")}).fail(function(){b.msg("请求失败，请重试！")});else{var d=JSON.parse('{"'+decodeURI(location.search.substring(1)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}');location.href="/activity/app-share/success?referrerMobile="+d.referrerMobile+"&mobile="+a("#mobile").val()}},iosCount:function(){timer=setInterval(function(){g.prop("disabled",!0).val(h+"s"),h--,0==h&&(clearInterval(timer),h=60,g.prop("disabled",!1).val("重新发送"))},1e3)},iosCaptcha:function(c){if(0==c)a.ajax({url:"/register/user/"+a("#mobile").val()+"/send-register-captcha",type:"get",dataType:"json"}).done(function(a){a.data.status&&!a.data.isRestricted?i.iosCount():!a.data.status&&a.data.isRestricted&&b.msg("短信发送频繁,请稍后再试")}).fail(function(){b.msg("请求失败，请重试！")});else{var d=JSON.parse('{"'+decodeURI(location.search.substring(1)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}');location.href="/activity/app-share/success?referrerMobile="+d.referrerMobile+"&mobile="+a("#mobile").val()}}};jQuery.validator.addMethod("isPhone",function(a,b){var c=/0?(13|14|15|18|17)[0-9]{9}/;return this.optional(b)||c.test(a)},"请正确填写您的手机号码"),d.validate({debug:!0,focusInvalid:!1,ignore:".ignore",rules:{mobile:{required:!0,digits:!0,isPhone:!0,minlength:11,maxlength:11,isExist:"/register/user/mobile/{0}/is-exist"},password:{required:!0,regex:/^(?=.*[^\d])(.{6,20})$/},captcha:{required:!0,digits:!0,maxlength:6,minlength:6,captchaVerify:{param:function(){var b=a("#mobile").val();return"/register/user/mobile/"+b+"/captcha/{0}/verify"}}},agreement:{required:!0}},messages:{mobile:{required:"请输入手机号",digits:"必须是数字",minlength:"手机格式不正确",isPhone:"请输入正确的手机号码",maxlength:"手机格式不正确",isExist:"手机号已存在"},password:{required:"请输入密码",regex:"6位至20位，不能全是数字"},captcha:{required:"请输入手机验证码",digits:"验证码格式不正确",maxlength:"验证码格式不正确",minlength:"验证码格式不正确",captchaVerify:"验证码不正确"},agreement:"请同意服务协议"},errorPlacement:function(a,b){a.appendTo(b.parent())},submitHandler:function(c){a.ajax({url:"/register/user/shared",type:"POST",dataType:"json",data:{mobile:a("#mobile").val(),password:a("#password").val(),captcha:a("#captcha").val(),referrer:JSON.parse('{"'+decodeURI(location.search.substring(1)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}').referrerMobile,agreement:"checked"==a("#agreement").attr("checked")}}).done(function(a){1==a.data.status?location.href="/activity/app-share/success?referrerMobile="+location.href.split("referrerMobile=")[1]:b.msg("请求失败，请重试！")}).fail(function(){b.msg("请求失败，请重试！")})}}),e.validate({debug:!0,focusInvalid:!1,ignore:".ignore",rules:{mobile:{required:!0,digits:!0,isPhone:!0,minlength:11,maxlength:11,isExist:"/register/user/mobile/{0}/is-exist"},captcha:{required:!0,digits:!0,maxlength:6,minlength:6,captchaVerify:{param:function(){var b=a("#mobile").val();return"/register/user/mobile/"+b+"/captcha/{0}/verify"}}},agreement:{required:!0}},messages:{mobile:{required:"请输入手机号",digits:"必须是数字",minlength:"手机格式不正确",isPhone:"请输入正确的手机号码",maxlength:"手机格式不正确",isExist:"手机号已存在"},captcha:{required:"请输入手机验证码",digits:"验证码格式不正确",maxlength:"验证码格式不正确",minlength:"验证码格式不正确",captchaVerify:"验证码不正确"},agreement:"请同意服务协议"},errorPlacement:function(a,b){a.appendTo(b.parent())},submitHandler:function(c){a.ajax({url:"/register/user/shared-prepare",type:"POST",dataType:"json",data:{mobile:a("#mobile").val(),captcha:a("#captcha").val(),referrerMobile:JSON.parse('{"'+decodeURI(location.search.substring(1)).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}').referrerMobile}}).done(function(a){1==a.data.status?location.href="/activity/app-share/success?referrerMobile="+location.href.split("referrerMobile=")[1]:b.msg("请求失败，请重试！")}).fail(function(){b.msg("请求失败，请重试！")})}}),f.on("click",function(c){c.preventDefault(),""!=a("#mobile").val()&&/0?(13|14|15|18|17)[0-9]{9}/.test(a("#mobile").val())&&(cnzzPush.trackClick("204APP分享","注册或者预注册页面","获取验证码"),a.ajax({url:"/register/user/mobile/"+a("#mobile").val()+"/is-register",type:"get",dataType:"json"}).done(function(a){i.anCaptcha(a.data.status)}).fail(function(a){b.msg("请求失败，请重试")}))}),g.on("click",function(c){c.preventDefault(),""!=a("#mobile").val()&&/0?(13|14|15|18|17)[0-9]{9}/.test(a("#mobile").val())&&(cnzzPush.trackClick("204APP分享","注册或者预注册页面","获取验证码"),a.ajax({url:"/register/user/mobile/"+a("#mobile").val()+"/is-register",type:"get",dataType:"json"}).done(function(a){i.iosCaptcha(a.data.status)}).fail(function(a){b.msg("请求失败，请重试")}))}),a("#agreeRule").on("click",function(c){c.preventDefault(),b.open({type:1,title:"拓天速贷服务协议",area:["100%","100%"],shadeClose:!0,move:!1,scrollbar:!0,content:a("#agreementBox"),success:function(a,b){}})})})});