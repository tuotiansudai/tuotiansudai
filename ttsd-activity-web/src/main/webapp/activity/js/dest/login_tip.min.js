define(["jquery","layerWrapper","jquery.ajax.extension","jquery.validate","jquery.form"],function(a,b){var c=a(".form-login"),d=a(".login-submit"),e=a(".captcha"),f=(a("i.error"),a(".image-captcha img")),g=function(){e.val(""),f.attr("src","/login/captcha?"+(new Date).getTime().toString())};f.click(function(){g()});var h=function(){return c.ajaxSubmit({beforeSubmit:function(a,b,c){d.addClass("loading")},success:function(a){a.status?window.location.reload():(g(),d.removeClass("loading"),b.msg(a.message))},error:function(){d.removeClass("loading"),g(),b.msg("用户或密码不正确")}}),!1};c.validate({debug:!0,rules:{username:{required:!0},password:{required:!0},captcha:{required:!0,minlength:5}},messages:{username:{required:"用户名不能为空"},password:{required:"密码不能为空"},captcha:{required:"验证码不能为空",minlength:"验证码不正确"}},errorPlacement:function(a,b){a.appendTo(b.parent())},submitHandler:function(a){h()}}),a("body").on("click",".close-btn",function(a){a.preventDefault(),b.closeAll()}).on("click",".show-login",function(c){c.preventDefault(),g(),a.ajax({url:"/activity/isLogin",type:"GET",dataType:"json",contentType:"application/json; charset=UTF-8"}).fail(function(c){if(""!=c.responseText){a("meta[name='_csrf']").remove(),a("head").append(a(c.responseText));var d=a("meta[name='_csrf']").attr("content"),e=a("meta[name='_csrf_header']").attr("content");a(document).ajaxSend(function(a,b,c){b.setRequestHeader(e,d)}),b.open({type:1,title:!1,closeBtn:0,area:["auto","auto"],content:a("#loginTip")})}})})});