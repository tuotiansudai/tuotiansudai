require(["jquery","drawCircle","template","layerWrapper","commonFun","logintip","register_common"],function(a,b,c,d,e){function f(a,b){var c=new Date(a);c.setDate(c.getDate()+b);var d=c.getFullYear(),e=c.getMonth()+1,f=c.getDate();return d+"-"+(e<10?"0"+e:e)+"-"+(f<10?"0"+f:f)}function g(b){a.ajax({url:"/activity/lantern-festival/invest/"+b,type:"GET",dataType:"json"}).done(function(b){if(b.status){a("#investRanking-tbody").parents("table");a("#investRanking-tbody").html(c("tplTable",b))}}).fail(function(){d.msg("请求失败，请重试！")})}var h=a("#lanternFrame"),i={},j=a("#TodayAwards"),k=a("#investRanking-button"),l=a("#heroNext"),m=a("#heroPre"),n=a.trim(j.val()),o=globalFun.parseURL(location.href);"yes"==globalFun.parseURL(location.href).params.tag&&h.find(".reg-tag-current").show(),"app"==o.params.source&&a.when(e.isUserLogin()).done(function(){}).fail(function(){a(".app-list-text",h).html('当前排名：<a href="/login">登录查看</a>'),a(".app-loan-text",h).text("今日投资额：0.00元")}),h.find(".tip-list-frame .tip-list").each(function(b,c){var d=a(c).data("return");i[d]=c}),n.replace(/-/gi,"")==parseInt(a("#activityStartTime").val().substr(0,10).replace(/-/gi,""))?(m.hide(),l.hide()):n.replace(/-/gi,"")==parseInt(a("#activityEndTime").val().substr(0,10).replace(/-/gi,""))?l.hide():(n.replace(/-/gi,"")>parseInt(a("#activityStartTime").val().substr(0,10).replace(/-/gi,""))&&(n.replace(/-/gi,""),parseInt(a("#activityEndTime").val().substr(0,10).replace(/-/gi,""))),m.show(),l.hide()),k.find("span").on("click",function(b){var c,d=a("#HistoryAwards"),e=d.text();/heroPre/.test(b.target.id)?c=f(e,-1):/heroNext/.test(b.target.id)&&(c=f(e,1)),c.replace(/-/gi,"")==parseInt(a("#activityStartTime").val().substr(0,10).replace(/-/gi,""))?(m.hide(),l.show()):c.replace(/-/gi,"")==parseInt(a("#TodayAwards").val().replace(/-/gi,""))&&c.replace(/-/gi,"")>parseInt(a("#activityStartTime").val().substr(0,10).replace(/-/gi,""))?(m.show(),l.hide()):c.replace(/-/gi,"")==parseInt(a("#activityEndTime").val().substr(0,10).replace(/-/gi,""))&&c.replace(/-/gi,"")==parseInt(a("#TodayAwards").val().replace(/-/gi,""))?(m.show(),l.hide()):c.replace(/-/gi,"")>parseInt(a("#activityStartTime").val().substr(0,10).replace(/-/gi,""))&&c.replace(/-/gi,"")<parseInt(a("#TodayAwards").val().replace(/-/gi,""))&&(m.show(),l.show()),d.text(c),g(c)}),g(j.val()),function(b){function c(){l.hasClass("win-result")||(l.addClass("win-result"),setTimeout(function(){b.beginLuckDraw(function(c){if(l.removeClass("win-result"),b.showDrawTime(),0==c.returnCode){var d=c.prizeType.toLowerCase();a(i[d]).find(".prizeValue").text(c.prizeValue),b.noRotateFn(i[d])}else 1==c.returnCode?b.tipWindowPop(i.nochance):2==c.returnCode?a(".no-login-text",h).trigger("click"):3==c.returnCode?b.tipWindowPop(i.expired):4==c.returnCode&&b.tipWindowPop(i.authentication)})},1e3))}var d=a(".reward-gift-box",h),f=a("#MobileNumber"),g="/activity/lantern-festival/all-prize-list",j="/activity/lantern-festival/user-prize-list",k="/activity/lantern-festival/prize",l=a(".pointer-img",d),m=f.length?f.data("mobile"):"",n={mobile:m,activityCategory:"LANTERN_FESTIVAL_ACTIVITY"};b.prototype.showDrawTime=function(){a.ajax({url:"/activity/lantern-festival/drawTime",type:"GET",dataType:"json"}).done(function(b){a(".draw-time",d).text(b)})};var b=new b(g,j,k,n,d,3);b.GiftRecord(3),b.MyGift(3),b.showDrawTime(),l.find("img").on("click",function(){"app"==o.params.source?a.when(e.isUserLogin()).done(function(){c()}).fail(function(){location.href="/login"}):c()}),d.find(".menu-switch span").on("click",function(){var b=a(this),c=b.index(),e=d.find(".record-list ul");b.addClass("active").siblings().removeClass("active"),e.eq(c).show().siblings("ul").hide()})}(b),a(window).width()<700&&a(".bg-two .wp",h).append(a(".bg-two .rule-model",h))});